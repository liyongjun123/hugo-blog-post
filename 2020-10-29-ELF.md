---
title: "ELF"
date: 2020-10-29T23:11:52+08:00
draft: false
categories: ["C"]
tags: ["学习"]
toc: false
url: /2020/10/29/elf.html
---

## ELF

在 Linux 中，二进制可执行文件的标准格式叫做 ELF（Executable and Linkable Format）。从名字可以看出，它同时兼容可执行文件和可链接文件。



## 实例

elfdemo.c

```c
#include <stdio.h>
#include <stdlib.h>

static char static_data[16] = "I'm Static Data";
static char raw_static_data[40960];
static const char const_data[16] = "I'm Const Data";

int main(int args, char **argv)
{
	printf("Message In Main\n");

	return 0;
}
```

gcc -o elfdemo.out -no-pie elfdemo.c

```bash
$ ls -l elfdemo.out 
-rwxrwxr-x 1 liyongjun liyongjun 16744 10月 29 23:21 elfdemo.out

$ file elfdemo.out 
elfdemo.out: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=d31074c23465f875f6d188cea193a3c66bbb049c, for GNU/Linux 3.2.0, not stripped

$ readelf -h elfdemo.out 
ELF 头：
  Magic：   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 
  类别:                              ELF64
  数据:                              2 补码，小端序 (little endian)
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI 版本:                          0
  类型:                              EXEC (可执行文件)
  系统架构:                          Advanced Micro Devices X86-64
  版本:                              0x1
  入口点地址：               0x401050
  程序头起点：          64 (bytes into file)
  Start of section headers:          14760 (bytes into file)
  标志：             0x0
  Size of this header:               64 (bytes)
  Size of program headers:           56 (bytes)
  Number of program headers:         13
  Size of section headers:           64 (bytes)
  Number of section headers:         31
  Section header string table index: 30

```

- 可执行文件的大小是 16744 字节
- 文件格式是 64 位的 Linux 标准可执行文件（ELF 64-bit LSB executable），目标平台是 x86-64
- 程序的入口地址是 0x401050
- 该文件的 ELF 头的大小是 64 字节
- 文件中有 13 个 Program Header，每个 Program Header 的长度是 56 字节，信息存放在从文件头算起 64 字节的位置（程序头起点）
- 另外还有 31 个 Section Header，每个 Section Header 的大小是 64 字节，信息存放在从文件头算起 14760 字节的位置

根据这些信息，就可以依次定位到每个 Header，再根据 Header 中对每个段的描述，便可解析出文件内容。