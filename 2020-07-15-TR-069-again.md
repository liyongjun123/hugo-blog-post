---
title: "TR-069-again"
date: 2020-07-15T19:33:20+08:00
draft: false
categories: ["网络"]
tags: ["协议"]
toc: true
url: "/2020/07/10/tr-069-again"
---

## # TR-069 网络架构

![tr069网络框架](/images/tr069网络框架.png)

## # TR-069 协议栈结构

| CPE/ACS Application | 应用程序在 CPE 和 ACS 上使用 CWMP，在本地进行定义，但不是 CWMP 的一部分。 |
| ------------------- | ------------------------------------------------------------ |
| RPC Methods         | CWMP 定义的 RPC 方法，方法包括 CPE 参数，ACS 通过 RPC 方法访问对应参数。 |
| SOAP                | 基于 XML，对 RPC 进行编码，使用 SOAP 1.1                     |
| HTTP                | 使用 HTTP 1.1                                                |
| SSL/TLS             | 可选                                                         |
| TCP/IP              | TCP/IP                                                       |



## # 架构目标

在连接模型中提供灵活性

- CPE 和 ACS 都可以发起连接，避免在 CPE 和 ACS 之间维护一个长期的连接。
- ACS 和 CPE 之间的功能交互应当不受这个连接是由哪端发起的这个条件的约束，即使在 ACS 不支持发起连接的情况下，所有的 ACS 发起的业务应当能够在 CPE 发起的连接上正常处理。
- 允许一个或多个 ACS 为全部 CPE 提供服务，即使 CPE 是由多个供应商提供。

支持 ACS 和 CPE 的发现和关联

- 提供让 CPE 去搜寻既定业务提供商的 ACS 的机制。
- 提供允许 ACS 安全地识别一个 CPE 并把它跟用户/客户关联起来的机制。这种关联的机制支持用户交互式和完全自动式两种模型。

允许通过 ACS 控制和监视与 CPE 关联的各种参数。提供访问这些参数的机制设定了如下前提：

- 不同的 CPE 可以拥有不同的能力级别，执行可选功能的不同子集。ACS 必须能够找出某个特定 CPE 多拥有的能力。
- ACS 必须能够控制和检测 CPE 的当前配置。
- 协议应当允许定义和访问厂商自定义参数。

本协议是一个可扩展的协议，它包括支持将来对本标准的扩展的机制，同时也包括供应商特定要求的扩展的机制。



## # 假定

以下是 CWMP 定义时所作出的一些假定：

- 所有类型的 CPE（网桥，路由器等），在与 ACS 通信之前要获得 IP 地址。
- 在某一个时刻，一台 CPE 只能与一台 ACS 进行交互。在任何时候，CPE 需要知道一个它能连接的一台 ACS。
- 只有明确地改变与 ACS 的联系方式和身份鉴别方式，ACS 才能将一台 CPE 转移给另一个 ACS。



## # 参数

RPC 方法规范定义了一种通用机制，ACS 可以根据它来读写参数以达到配置 CPE 和监控 CPE 的状态和统计信息。

不同类 CPE 的参数定义在不同的文档中。

- TR-106：Data Model Template for TR-069-Enabled Devices

- TR-098：Internet Gateway Device Data Model for TR-069，专为 Internet 网关设备所定义的参数
- TR-104：Provisioning Parameters for VoIP CPE

每一个参数包括一个“name-value”对，name 用于区分不同的参数，采用与目录文件相似的层次化结构，级与级用“.”分隔开。参数的值可能时多种已定义的数据类型中的一种。

参数可以被摄制成只读或只写。只读参数可以让 ACS 用于确定特定 CPE 的特征，观察 CPE 的当前状态，或者收集统计信息。可写参数可以让 ACS 去定制各种 CPE 操作。所有可写参数必须时可读的，虽然那些包含用于机密性的信息，例如密码，可能会在读时返回一个空值。一些可写的参数能够被那些不同于本规范定义的接口所独立的更改（例如，一些参数也可以通过 LAN 侧的自动配置协议所修改）。



## # 文件传输

RPC 方法规范定义了一种文件下载或为了各种目的的上载（例如对固件和配置文件的更新）的机制。

ACS 发起文件传输后，CPE 将获得传输文件的位置，使用 HTTP 协议，或者可选地使用 HTTPS、FTP或者TFTP作为传输协议。CPE 接着执行传输，并向 ACS 通告成功或者失败。

可选地，可由 CPE 首先发起下载。



## # CPE 发起会话

RPC 方法规范定义了一种允许 CPE 向对应的ACS通过各种状态的机制，同时保证了 CPE-ACS 通信发生的最小频率。

它包括 CPE 初始安装时发起的建立通信的机制，用于“bootsrap”（引导）初始的客户参数到 CPE 中去。也包括在工作过程中和 ACS 周期通信的机制，或者事件发生时必须通知 ACS（例如当 CPE 的宽带 IP 地址发生改变时）。

在任何一种情况下，当通信建立后，CPE 通过制造商及序列号信息来唯一地标识自己，使 ACS 了解正在进行通信的是哪台 CPE，并用恰当的方法来响应它。



## # ACS 发起的异步会话

服务自动配置的一个重要方面是ACS能够异步地通知CPE某一配置的改变。这使得自动配置机制可用于需要对CPE进行近于实时配置的服务。比如，这一特性可用来给最终用户立即提供预定服务/特性，而无需等待下一阶段通知的时延。

CWMP 包含一种可以让 ACS 在任何时候向 CPE 发起连接请求的机制，通知 CPE 向 ACS 建立一个通讯会话。

![tr069-ACS发起异步会话](/images/tr069-ACS发起异步会话.png)

同时 CWMP 也允许用 CPE polling 来代替 ACS 发起连接，CWMP不会依靠 polling 或建立 CPE 的永久连接来提供异步通知。







