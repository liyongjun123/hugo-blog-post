---
title: "awk"
date: 2020-11-05T16:40:20+08:00
draft: false
categories: ["Linux"]
tags: ["cmd"]
toc: false
url: /2020/11/05/awk.html
---

## 开始

实用的 awk 程序通常都很短，只有一两行。

假设有一个文件，叫做 emp.data，这个文件包含有名字、每个小时工资（单位元）、工作时长，每一行代表一个雇员的记录，就像这样

```
Beth	4.00	0
Dan		3.75	0
Kathy	4.00	10
Mark	5.00	20
Mary	5.50	22
Susie	4.25	18
```

现在你想打印每位雇员的名字以及他们的报酬（每小时工资乘以工作时长），而雇员的工作时长必须大于零。这种类型的工作是 awk 的设计目标之一，所以会很简单。只要键入下面一行即可：

```bash
awk '$3 > 0 { print $1, $2 * $3 }' emp.data
```

该行命令告诉操作系统运行 awk 程序，被运行的程序用**单引号**包围起来，从输入文件 emp.data 获取数据。被但引号包围的部分是一个完整的 awk 程序。它由一个单独的 **模式-动作** 语句（pattern-action statement）组成。模式 $3 > 0 扫描每一行输入行，如果该行的第三列（或者说 **字段**（field）大于零），则动作 { print $1, $2 * $3 } 就会为每一个匹配行打印第一个字段，以及第二与第三个字段的乘积。

如果想知道哪些员工在偷懒，键入

```bash
awk '$3 == 0 { print $1 }' emp.data
```

模式 $3 == 0 匹配第三个字段为零的行，动作 { print $1 } 打印该行的第一个字段。

## AWK 程序的结构

每一个 awk 程序都是由一个或多个 模式-动作 语句组成的序列：

pattern {action}

pattern {action}

...

awk 的基本操作是在由输入行组成的序列中，陆续地扫描每一行，搜索可以被模式 匹配（match）的行。

程序 `$3 == 0 { print $1 }` 由一条单独的 模式-动作 语句组成。在一个 模式-动作 语句中，模式或动作可以省略其一，但不能两者同时省略。

如果一个模式没有动作，例如 `$3 == 0` 会将每一个匹配行（也就是条件判断为真的行）打印出来。

如果只有动作而没有模式，例如 `{ print $1 }` 对于每一个输入行，动作都会被执行。

因为模式与动作都是可选的，所以**用花括号将动作包围起来**，以便区分两者。

## 规则介绍

- awk 的数据只有两种类型：数值、由字符组成的字符串。
- awk 从它的输入中每次读取一行，将行分解为一个个的字段（默认将字段看作是非空白符组成的序列）。
- 当前输入行的第一个字段叫做 $1，第二个是 $2，依次类推。
- 一整行记为 $0。
- 每行的字段数可能不一样。